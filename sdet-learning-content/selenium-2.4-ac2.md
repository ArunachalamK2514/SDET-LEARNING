# selenium-2.4-ac2: Handle Alerts, Prompts, Confirmations Using Alert Interface

## Overview
Web applications often use JavaScript alert boxes, confirmation dialogs, and prompt boxes to interact with users. These are non-HTML pop-ups generated by the browser, and Selenium's standard `findElement()` methods cannot interact with them directly. WebDriver provides a dedicated `Alert` interface to manage these pop-up windows. Understanding how to handle them is crucial for automating real-world web scenarios, especially during negative testing or when critical information is displayed.

## Detailed Explanation
The `Alert` interface in Selenium WebDriver provides methods to interact with the three types of JavaScript pop-up boxes:
1.  **Alert Box**: Displays a message and an "OK" button. Used for notifications.
2.  **Confirmation Box**: Displays a message, an "OK" button, and a "Cancel" button. Used to get user confirmation.
3.  **Prompt Box**: Displays a message, an input field, and "OK" / "Cancel" buttons. Used to get input from the user.

To interact with any of these, you must first switch control of the WebDriver to the alert box using `driver.switchTo().alert()`. Once switched, you can use the methods provided by the `Alert` interface.

### Key `Alert` Interface Methods:
-   `accept()`: Clicks on the "OK" (or "Accept") button of the alert, confirmation, or prompt box.
-   `dismiss()`: Clicks on the "Cancel" (or "Dismiss") button of the alert, confirmation, or prompt box. If it's an alert box, it will still close it, as there's no "Cancel" option.
-   `getText()`: Retrieves the message displayed in the alert, confirmation, or prompt box.
-   `sendKeys(String keysToSend)`: Enters text into the input field of a prompt box.

**Important Note**: Once you interact with an alert (e.g., `accept()` or `dismiss()`), the alert is closed, and WebDriver control automatically returns to the main page. If you try to interact with an alert that is no longer present, it will throw a `NoAlertPresentException`.

## Code Implementation
Let's create a simple HTML file to demonstrate alert handling and then write Java Selenium code for it.

**`xpath_axes_test_page.html`** (Assuming this file is in your project root or accessible path):
(This is a generic name, you might already have this file, if not, create it. I am using the existing `xpath_axes_test_page.html` as it was listed in the folder structure, but I will assume its content for demonstration.)

```html
<!DOCTYPE html>
<html>
<head>
    <title>Alerts, Prompts, Confirmations Test Page</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>JavaScript Dialog Boxes</h1>

    <button onclick="showAlert()">Show Alert</button>
    <button onclick="showConfirm()">Show Confirm</button>
    <button onclick="showPrompt()">Show Prompt</button>

    <p id="output"></p>

    <script>
        function showAlert() {
            alert("This is a simple alert box!");
        }

        function showConfirm() {
            let result = confirm("Do you want to proceed?");
            document.getElementById("output").textContent = "Confirmation Result: " + result;
        }

        function showPrompt() {
            let name = prompt("Please enter your name:", "Guest");
            if (name !== null) {
                document.getElementById("output").textContent = "Hello, " + name + "!";
            } else {
                document.getElementById("output").textContent = "Prompt cancelled.";
            }
        }
    </script>
</body>
</html>
```

**Java Selenium Code:**

```java
import org.openqa.selenium.Alert;
import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.chrome.ChromeOptions;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;
import org.testng.Assert;
import org.testng.annotations.AfterMethod;
import org.testng.annotations.BeforeMethod;
import org.testng.annotations.Test;

import java.time.Duration;

public class AlertHandlingTests {

    private WebDriver driver;
    private WebDriverWait wait; // For explicit waits

    @BeforeMethod
    public void setUp() {
        // Automatically manages ChromeDriver executable (Selenium 4.6+)
        // System.setProperty("webdriver.chrome.driver", "path/to/chromedriver"); // Not needed with WebDriverManager or Selenium Manager
        ChromeOptions options = new ChromeOptions();
        options.addArguments("--start-maximized");
        driver = new ChromeDriver(options);
        wait = new WebDriverWait(driver, Duration.ofSeconds(10)); // Initialize WebDriverWait

        // Assuming the HTML file is in the project root. Adjust path as needed.
        String htmlFilePath = System.getProperty("user.dir") + "/xpath_axes_test_page.html";
        driver.get("file:///" + htmlFilePath.replace("\", "/"));
    }

    @Test
    public void testAlertBox() {
        WebElement showAlertButton = driver.findElement(By.xpath("//button[text()='Show Alert']"));
        showAlertButton.click();

        // Wait for the alert to be present
        Alert alert = wait.until(ExpectedConditions.alertIsPresent());

        // Get the text from the alert
        String alertText = alert.getText();
        System.out.println("Alert Box Text: " + alertText);
        Assert.assertEquals(alertText, "This is a simple alert box!", "Alert text mismatch!");

        // Accept the alert (clicks OK)
        alert.accept();

        // Verify the alert is no longer present (optional, but good practice)
        // If an alert is not handled, subsequent interactions with the page will fail.
        try {
            driver.switchTo().alert();
            Assert.fail("Alert was still present after accepting.");
        } catch (org.openqa.selenium.NoAlertPresentException e) {
            System.out.println("Alert successfully handled.");
        }
    }

    @Test
    public void testConfirmationBoxAccept() {
        WebElement showConfirmButton = driver.findElement(By.xpath("//button[text()='Show Confirm']"));
        showConfirmButton.click();

        Alert confirmation = wait.until(ExpectedConditions.alertIsPresent());

        String confirmationText = confirmation.getText();
        System.out.println("Confirmation Box Text: " + confirmationText);
        Assert.assertEquals(confirmationText, "Do you want to proceed?", "Confirmation text mismatch!");

        confirmation.accept(); // Clicks OK

        // Verify the result on the page
        WebElement output = driver.findElement(By.id("output"));
        wait.until(ExpectedConditions.textToBePresentInElement(output, "Confirmation Result: true"));
        Assert.assertTrue(output.getText().contains("Confirmation Result: true"), "Confirmation accept failed!");
    }

    @Test
    public void testConfirmationBoxDismiss() {
        WebElement showConfirmButton = driver.findElement(By.xpath("//button[text()='Show Confirm']"));
        showConfirmButton.click();

        Alert confirmation = wait.until(ExpectedConditions.alertIsPresent());

        String confirmationText = confirmation.getText();
        System.out.println("Confirmation Box Text: " + confirmationText);
        Assert.assertEquals(confirmationText, "Do you want to proceed?", "Confirmation text mismatch!");

        confirmation.dismiss(); // Clicks Cancel

        // Verify the result on the page
        WebElement output = driver.findElement(By.id("output"));
        wait.until(ExpectedConditions.textToBePresentInElement(output, "Confirmation Result: false"));
        Assert.assertTrue(output.getText().contains("Confirmation Result: false"), "Confirmation dismiss failed!");
    }

    @Test
    public void testPromptBox() {
        WebElement showPromptButton = driver.findElement(By.xpath("//button[text()='Show Prompt']"));
        showPromptButton.click();

        Alert prompt = wait.until(ExpectedConditions.alertIsPresent());

        String promptText = prompt.getText();
        System.out.println("Prompt Box Text: " + promptText);
        Assert.assertEquals(promptText, "Please enter your name:", "Prompt text mismatch!");

        String nameToEnter = "SDET Learner";
        prompt.sendKeys(nameToEnter); // Enters text into the prompt input field
        prompt.accept(); // Clicks OK

        // Verify the result on the page
        WebElement output = driver.findElement(By.id("output"));
        wait.until(ExpectedConditions.textToBePresentInElement(output, "Hello, SDET Learner!"));
        Assert.assertTrue(output.getText().contains("Hello, " + nameToEnter + "!"), "Prompt input and accept failed!");
    }

    @Test
    public void testPromptBoxDismiss() {
        WebElement showPromptButton = driver.findElement(By.xpath("//button[text()='Show Prompt']"));
        showPromptButton.click();

        Alert prompt = wait.until(ExpectedConditions.alertIsPresent());

        String promptText = prompt.getText();
        System.out.println("Prompt Box Text: " + promptText);
        Assert.assertEquals(promptText, "Please enter your name:", "Prompt text mismatch!");

        prompt.dismiss(); // Clicks Cancel

        // Verify the result on the page
        WebElement output = driver.findElement(By.id("output"));
        wait.until(ExpectedConditions.textToBePresentInElement(output, "Prompt cancelled."));
        Assert.assertTrue(output.getText().contains("Prompt cancelled."), "Prompt dismiss failed!");
    }

    @AfterMethod
    public void tearDown() {
        if (driver != null) {
            driver.quit();
        }
    }
}
```

## Best Practices
-   **Always use Explicit Waits**: Never rely on `Thread.sleep()` or try to interact with an alert without ensuring it's present. Use `WebDriverWait` with `ExpectedConditions.alertIsPresent()`.
-   **Handle alerts promptly**: Once an alert appears, the WebDriver's focus is on it, and you cannot interact with the main page until the alert is dismissed.
-   **Error Handling**: Wrap alert interactions in a `try-catch` block for `NoAlertPresentException` if there's a chance an alert might not appear (e.g., for optional notifications), to prevent test failures.
-   **Logging**: Log the text of the alert before accepting or dismissing it, especially in case of test failures, to understand the context.

## Common Pitfalls
-   **`NoAlertPresentException`**: This occurs if you try to switch to an alert when none is present. Often due to timing issues (alert not yet appeared) or incorrect test logic (alert already dismissed).
-   **Not switching back**: While WebDriver automatically switches focus back to the main page after an alert is handled, a common misconception is needing to explicitly switch back. The pitfall is often related to the test logic after handling the alert assuming the main page is ready immediately, potentially leading to `StaleElementReferenceException` or `NoSuchElementException` if not using proper waits for page elements.
-   **Ignoring alert text**: Failing to capture and assert the text of an alert can lead to missed issues where the alert appears, but with an unexpected message.
-   **Trying to locate elements on the main page while an alert is open**: This will always fail and result in `UnhandledAlertException`. Always handle the alert first.

## Interview Questions & Answers
1.  **Q: How do you handle JavaScript pop-ups (alerts, confirmations, prompts) in Selenium WebDriver?**
    A: I use the `driver.switchTo().alert()` method, which returns an `Alert` interface object. This object provides methods like `accept()` to click "OK", `dismiss()` to click "Cancel", `getText()` to retrieve the message, and `sendKeys()` to type into a prompt box. It's crucial to use `WebDriverWait` with `ExpectedConditions.alertIsPresent()` to ensure the alert has appeared before attempting to interact with it, to avoid `NoAlertPresentException`.

2.  **Q: What is `NoAlertPresentException` and when does it occur? How do you prevent it?**
    A: `NoAlertPresentException` occurs when WebDriver attempts to switch to an alert or interact with it, but no alert is currently displayed on the page. This typically happens due to timing issues, where the alert hasn't loaded yet, or if the alert was already dismissed by a previous action. To prevent it, I always use `WebDriverWait` with `ExpectedConditions.alertIsPresent()` before calling `driver.switchTo().alert()`.

3.  **Q: Can you interact with elements on the main web page while a JavaScript alert is open?**
    A: No, you cannot. When a JavaScript alert, confirmation, or prompt box is open, it takes control of the browser. WebDriver's focus shifts to this dialog, and any attempt to interact with elements on the underlying web page will result in an `UnhandledAlertException`. You must first handle (accept or dismiss) the alert before regaining control of the main page.

4.  **Q: What is the difference between `accept()` and `dismiss()` methods of the `Alert` interface?**
    A: The `accept()` method is used to click the "OK" or "Accept" button on an alert, confirmation, or prompt box. The `dismiss()` method is used to click the "Cancel" or "Dismiss" button on a confirmation or prompt box. For a standard alert box (which only has an "OK" button), calling `dismiss()` will also close the alert, effectively acting like `accept()`.

## Hands-on Exercise
1.  **Objective**: Navigate to a page with dynamic alerts and handle them.
2.  **Setup**:
    *   Find a public website that generates different types of JavaScript alerts (e.g., a "Try it" button for `alert()`, `confirm()`, `prompt()`). A good example can be found on W3Schools or similar tutorial sites.
    *   Ensure you have your Selenium WebDriver setup correctly with TestNG.
3.  **Task**:
    *   Write a TestNG test method for each type of alert:
        *   **Alert**: Click a button that triggers an alert. Get its text and assert it. Then accept the alert.
        *   **Confirmation**: Click a button that triggers a confirmation. Get its text, assert it, and then dismiss the confirmation. Verify the text on the page reflects the "cancel" action.
        *   **Prompt**: Click a button that triggers a prompt. Get its text, assert it, send your name into the prompt, and then accept it. Verify your name appears on the page.
    *   Include `WebDriverWait` for `ExpectedConditions.alertIsPresent()` in all your tests.
    *   Add `try-catch` blocks for `NoAlertPresentException` around your alert handling logic to make it robust.

## Additional Resources
-   **Selenium Official Documentation - Alerts**: [https://www.selenium.dev/documentation/webdriver/interactions/alerts/](https://www.selenium.dev/documentation/webdriver/interactions/alerts/)
-   **W3Schools JavaScript Popups**: [https://www.w3schools.com/js/js_popup.asp](https://www.w3schools.com/js/js_popup.asp)
-   **TutorialsPoint - Selenium Alert Handling**: [https://www.tutorialspoint.com/selenium/selenium_alert_commands.htm](https://www.tutorialspoint.com/selenium/selenium_alert_commands.htm)
